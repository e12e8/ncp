# 农产品直销平台毕业答辩功能细节指南

> 本指南严格对应项目实际代码实现，每个功能点均提供**精确到行号的操作流程**和**可验证的核心代码片段**。所有内容均可在`src/main/java`目录下验证。

## 一、用户端核心操作流程

### 1. 添加商品到购物车（高频实操考点）
**操作步骤**：
1. 用户在商品详情页点击【加入购物车】按钮
2. 前端调用`cart/add`接口（`CartController.add()`）
3. 系统执行以下核心逻辑：

**关键代码定位**：`CartController.java` 第310-330行
```java
// CartController.java
@RequestMapping("/add")
public R add(@RequestBody CartEntity cart, HttpServletRequest request){
    // 1. 检查是否已存在相同商品（包括相同购买数量）
    Wrapper<CartEntity> queryWrapper = new EntityWrapper<CartEntity>()
        .eq("yonghu_id", cart.getYonghuId())
        .eq("nongchanpin_id", cart.getNongchanpinId())
        .eq("buy_number", cart.getBuyNumber());
    
    CartEntity cartEntity = cartService.selectOne(queryWrapper);
    if(cartEntity==null){
        // 2. 不存在则新增购物车记录
        cart.setCreateTime(new Date());
        cart.setInsertTime(new Date());
        cartService.insert(cart);
        return R.ok();
    }else {
        // 3. 已存在则返回错误提示
        return R.error(511,"表中有相同数据");
    }
}
```
**答辩要点**：
- 说明重复商品检查逻辑（避免购物车中出现完全相同的商品条目）
- 指出当前实现不合并数量的设计特点
- 可能被问："如果用户想购买多个相同商品怎么办？" → 回答："用户可以直接修改购物车中的购买数量，或在添加时指定所需数量"

### 2. 修改个人信息（必考）
**操作步骤**：
1. 用户进入【个人中心】→【编辑资料】
2. 提交修改请求到`yonghu/update`接口
3. 系统执行以下核心逻辑：

**关键代码定位**：`YonghuController.java` 第142-171行
```java
// YonghuController.java
@RequestMapping("/update")
public R update(@RequestBody YonghuEntity yonghu, HttpServletRequest request){
    // 1. 校验账户名、手机号、身份证号的唯一性（核心）
    Wrapper<YonghuEntity> queryWrapper = new EntityWrapper<YonghuEntity>()
        .notIn("id", yonghu.getId())
        .andNew()
        .eq("username", yonghu.getUsername())
        .or()
        .eq("yonghu_phone", yonghu.getYonghuPhone())
        .or()
        .eq("yonghu_id_number", yonghu.getYonghuIdNumber());
    
    YonghuEntity yonghuEntity = yonghuService.selectOne(queryWrapper);
    
    // 2. 处理照片为空的情况
    if("null".equals(yonghu.getYonghuPhoto()) || "".equals(yonghu.getYonghuPhoto())){
        yonghu.setYonghuPhoto(null);
    }
    
    // 3. 执行更新
    if(yonghuEntity==null){
        yonghuService.updateById(yonghu);
        return R.ok();
    }else {
        return R.error(511,"账户或者用户手机号或者用户身份证号已经被使用");
    }
}
```
**答辩要点**：
- 重点说明三重唯一性校验（账户名、手机号、身份证号）的设计考虑
- 解释`notIn("id", yonghu.getId())`如何排除当前用户自身记录
- 说明照片字段的空值处理逻辑
- 可能被问："为什么不用数据库唯一索引？" → 回答："业务层校验可以提供更友好的错误提示，同时处理多种字段组合的唯一性校验"

## 二、商家端核心操作流程

### 3. 发布农产品（核心功能）
**操作步骤**：
1. 商家登录后台 →【商品管理】→【发布商品】
2. 上传图片并填写商品信息
3. 系统执行以下核心逻辑：

**关键代码定位**：`NongchanpinController.java` 第122-154行
```java
// NongchanpinController.java
@RequestMapping("/save")
public R save(@RequestBody NongchanpinEntity nongchanpin, HttpServletRequest request){
    // 1. 获取当前商家ID并设置到商品信息中
    String role = String.valueOf(request.getSession().getAttribute("role"));
    if("商家".equals(role)){
        nongchanpin.setShangjiaId(Integer.valueOf(String.valueOf(request.getSession().getAttribute("userId"))));
    }
    
    // 2. 检查是否已存在相同商品（同一商家下相同名称、类型、库存等条件）
    Wrapper<NongchanpinEntity> queryWrapper = new EntityWrapper<NongchanpinEntity>()
        .eq("shangjia_id", nongchanpin.getShangjiaId())
        .eq("nongchanpin_name", nongchanpin.getNongchanpinName())
        .eq("nongchanpin_types", nongchanpin.getNongchanpinTypes())
        .eq("nongchanpin_kucun_number", nongchanpin.getNongchanpinKucunNumber())
        .eq("nongchanpin_clicknum", nongchanpin.getNongchanpinClicknum())
        .eq("shangxia_types", nongchanpin.getShangxiaTypes())
        .eq("nongchanpin_delete", nongchanpin.getNongchanpinDelete());
    
    NongchanpinEntity nongchanpinEntity = nongchanpinService.selectOne(queryWrapper);
    if(nongchanpinEntity==null){
        // 3. 设置默认值并保存
        nongchanpin.setNongchanpinClicknum(1);   // 默认点击量为1
        nongchanpin.setShangxiaTypes(1);         // 默认上架状态
        nongchanpin.setNongchanpinDelete(1);     // 默认未删除
        nongchanpin.setCreateTime(new Date());
        nongchanpinService.insert(nongchanpin);
        return R.ok();
    }else {
        // 4. 已存在则返回错误提示
        return R.error(511,"表中有相同数据");
    }
}
```
**答辩要点**：
- 重点说明商家身份验证和数据关联
- 解释商品重复检查的条件设计
- 说明默认值设置的业务含义（点击量、上架状态、删除状态）
- 可能被问："为什么要检查这么多字段的重复性？" → 回答："确保商家不会发布完全相同的商品，避免数据冗余"

### 4. 发货操作（订单核心）
**操作步骤**：
1. 商家在【订单管理】中点击【发货】
2. 填写物流信息并确认
3. 系统执行以下核心逻辑：

**关键代码定位**：`NongchanpinOrderController.java` 第161-183行
```java
// NongchanpinOrderController.java
@RequestMapping("/update")
public R update(@RequestBody NongchanpinOrderEntity nongchanpinOrder, HttpServletRequest request){
    // 1. 获取当前用户角色
    String role = String.valueOf(request.getSession().getAttribute("role"));
    
    // 2. 简单校验是否存在相同订单（实际发货功能通过修改订单信息实现）
    Wrapper<NongchanpinOrderEntity> queryWrapper = new EntityWrapper<NongchanpinOrderEntity>()
        .eq("id", 0);  // 固定条件，实际上不会有匹配结果
    
    NongchanpinOrderEntity nongchanpinOrderEntity = nongchanpinService.selectOne(queryWrapper);
    if(nongchanpinOrderEntity==null){
        // 3. 执行订单更新（发货操作通过修改订单的物流信息和状态实现）
        nongchanpinOrderService.updateById(nongchanpinOrder);
        return R.ok();
    }else {
        return R.error(511,"表中有相同数据");
    }
}
```
**答辩要点**：
- 说明发货操作的实现方式（通过修改订单信息，包括物流信息和订单状态）
- 指出当前实现的简化设计（缺少订单状态机校验）
- 可能被问："如何优化发货操作？" → 回答："可以添加订单状态校验，确保只有已付款订单才能发货，同时使用乐观锁防止并发问题"

## 三、管理员端核心操作流程

### 5. 公告发布流程（基础功能）
**操作步骤**：
1. 管理员登录 →【系统管理】→【公告管理】
2. 编辑公告内容并发布
3. 系统执行以下核心逻辑：

**关键代码定位**：`GonggaoController.java` 第113-136行
```java
// GonggaoController.java
@RequestMapping("/save")
public R save(@RequestBody GonggaoEntity gonggao, HttpServletRequest request){
    logger.debug("save方法:,,Controller:{},,gonggao:{}",this.getClass().getName(),gonggao.toString());

    String role = String.valueOf(request.getSession().getAttribute("role"));
    if(false)
        return R.error(511,"永远不会进入");

    // 1. 检查是否已存在相同名称和类型的公告
    Wrapper<GonggaoEntity> queryWrapper = new EntityWrapper<GonggaoEntity>()
        .eq("gonggao_name", gonggao.getGonggaoName())
        .eq("gonggao_types", gonggao.getGonggaoTypes());

    logger.info("sql语句:"+queryWrapper.getSqlSegment());
    GonggaoEntity gonggaoEntity = gonggaoService.selectOne(queryWrapper);
    if(gonggaoEntity==null){
        // 2. 设置时间字段并保存
        gonggao.setInsertTime(new Date());
        gonggao.setCreateTime(new Date());
        gonggaoService.insert(gonggao);
        return R.ok();
    }else {
        return R.error(511,"表中有相同数据");
    }
}
```
**答辩要点**：
- 重点说明公告重复检查逻辑（相同名称和类型的公告不允许重复发布）
- 解释时间字段的设置（插入时间和创建时间）
- 说明日志记录的设计（便于调试和审计）
- 可能被问："管理员发布公告时需要什么权限？" → 回答："目前系统通过角色检查实现，只有管理员角色可以访问公告管理功能"

## 四、答辩必备操作清单

### 6. 必须演示的5个操作流程
| 操作类型 | 演示路径 | 核心代码文件 | 答辩话术 |
|----------|----------|--------------|----------|
| **用户购物流程** | 商品详情 → 加入购物车 → 结算 | `CartController.java` | "购物车重复检查逻辑确保数据一致性..." |
| **商家发货流程** | 订单管理 → 发货 | `NongchanpinOrderController.java` | "订单更新操作实现发货功能，可后续优化添加状态校验..." |
| **个人信息修改** | 个人中心 → 编辑资料 | `YonghuController.java` | "三重唯一性校验（账户名、手机号、身份证号）保障数据准确性..." |
| **商品发布流程** | 商品管理 → 发布商品 | `NongchanpinController.java` | "商家身份验证和商品重复检查确保数据完整性..." |
| **公告发布流程** | 系统管理 → 公告管理 | `GonggaoController.java` | "公告重复检查和时间戳设置确保信息管理的规范性..." |

> **终极提醒**：
> 1. 演示时**必须打开对应Java文件**，手指着代码解释
> 2. 遇到技术问题回答："这部分代码实现了[功能]，核心逻辑在[行号]，我的理解是..."
> 3. **禁止**说"这是外包做的"，改为："该模块遵循Spring Boot最佳实践，重点实现了..."